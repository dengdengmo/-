function play(){myAudio.play(),$(".btn-play").removeClass("icon-play").addClass("icon-pause1")}function pause(){myAudio.pause(),$(".btn-play").removeClass("icon-pause1").addClass("icon-play")}function getChannel(){$.ajax({type:"get",url:"https://api.jirengu.com/fm/getChannels.php",dataType:"jsonp",jsonp:"jsoncallback",success:function(i){var t=i.channels,c=Math.floor(Math.random()*t.length),a=t[c].name,r=t[c].channel_id;$(".record").text(" ："+a),$(".record").attr("data-id",r),getmusic()}})}function getmusic(){$.ajax({type:"get",url:"https://api.jirengu.com/fm/getSong.php",dataType:"jsonp",jsonp:"jsoncallback",data:{channel:$(".record").attr("data-id")},success:function(i){var t=i.song[0],c=t.url;sid=t.sid,title=t.title,artist=t.artist,bgPic=t.picture,$("audio").attr("src",c),$("audio").attr("sid",sid),$(".musicname").text(title),$(".musicname").attr("title",title),$(".musicer").text("歌 手："+artist),$(".musicer").attr("title",artist),$(".background").css({"background-image":"url("+bgPic+")","background-repeat":"no-repeat","background-position-x":"0px","background-position-y":"center","background-attchment":"fixed","background-size":"cover"}),play(),getlyric(),changeBackground()}})}function getlyric(){var i=$("audio").attr("sid");$.post("http://api.jirengu.com/fm/getLyric.php",{sid:i}).done(function(i){var i=JSON.parse(i);if(console.log(i),i.lyric){$(".music-lyric .lyric").empty();var t=i.lyric.split("\n"),c=/\[\d{2}:\d{2}.\d{2}\]/g,a=[];if(""!=t)for(var r in t){var e=t[r].match(c);if(e){var n=t[r].replace(c,"");for(j in e){var o=e[j].slice(1,-1).split(":"),l=60*parseInt(o[0],10)+parseFloat(o[1]);a.push([l,n])}}}a.sort(function(i,t){return i[0]-t[0]}),lyricArr=a,renderLyric()}}).fail(function(){$(".music-lyric .lyric").html("<li>本歌曲暂时展示没有歌词</li>")})}function renderLyric(){for(var i="",t=0;t<lyricArr.length;t++)i+="<li data-time='"+lyricArr[t][0]+"'>"+lyricArr[t][1]+"</li>";$(".music-lyric .lyric").append(i),setInterval(showLyric,100)}function showLyric(){for(var i=$(".lyric li").eq(15).outerHeight(),t=0;t<lyricArr.length;t++){var c=$(".lyric li").eq(t).attr("data-time"),a=$(".lyric li").eq(t+1).attr("data-time");myAudio.currentTime>c&&c<a&&($(".lyric li").removeClass("active"),$(".lyric li").eq(t).addClass("active"),$(".music-lyric .lyric").css("top",-i*(t-3)))}}function present(){var i=myAudio.currentTime/myAudio.duration*100;$(".progressbar").width(i+"%"),myAudio.currentTime==myAudio.duration&&getmusic()}function changeLyric(){$(".icon-leyic").toggleClass("lyriced"),$(".icon-leyic").hasClass("lyriced")?($(".background .music-lyric").css({display:"block"}),$(".background").css({"background-image":""}),$(".controls .icon-leyic").attr("title","隐藏歌词")):($(".background .music-lyric").css({display:"none"}),$(".controls .icon-leyic").attr("title","显示歌词"),$(".background").css({"background-image":"url("+bgPic+")"}))}function changeBackground(){$(".icon-leyic").hasClass("lyriced")&&($(".background .music-lyric").css({display:"block"}),$(".background").css({"background-image":""}),$(".controls .icon-leyic").attr("title","隐藏歌词"))}var myAudio=$("audio")[0],bgPic,lyricArr=[];$(".btn-play").click(function(){myAudio.paused?play():pause()}),$(".icon-diantai").click(function(){getChannel()}),$(".btn-next").click(function(){getmusic()}),setInterval(present,500),$(".basebar").mousedown(function(i){var t=i.clientX;console.log(t);var c=(t-$(this).offset().left)/400*100;myAudio.currentTime=myAudio.duration*c/100}),$(".icon-shoucang").on("click",function(){$(this).toggleClass("stared")}),$(".icon-danquxunhuan1").on("click",function(){$(this).toggleClass("recycleed").toggleClass("colored"),$(this).hasClass("recycleed")&&($("audio").attr("loop",!0),$(".icon-danquxunhuan1").attr("title","取消单曲循环")),$(this).hasClass("colored")&&($("audio").attr("loop",!1),$(".icon-danquxunhuan1").attr("title","单曲循环"))}),$(".icon-leyic").on("click",changeLyric),$(document).ready(getChannel());

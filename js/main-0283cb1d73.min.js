function play(){myAudio.play(),$(".btn-play").removeClass("icon-play").addClass("icon-pause1")}function pause(){myAudio.pause(),$(".btn-play").removeClass("icon-pause1").addClass("icon-play")}function getChannel(){$.ajax({type:"get",url:"http://api.jirengu.com/fm/getChannels.php",dataType:"jsonp",jsonp:"callback",jsonpCallback:"?",success:function(i){var c=i.channels,t=Math.floor(Math.random()*c.length),a=c[t].name,r=c[t].channel_id;$(".record").text(" ："+a),$(".record").attr("data-id",r),getmusic()}})}function getmusic(){$.ajax({type:"get",url:"http://api.jirengu.com/fm/getSong.php",dataType:"jsonp",jsonp:"callback",jsonpCallback:"?",data:{channel:$(".record").attr("data-id")},success:function(i){var c=i.song[0],t=c.url;sid=c.sid,title=c.title,artist=c.artist,bgPic=c.picture,$("audio").attr("src",t),$("audio").attr("sid",sid),$(".musicname").text(title),$(".musicname").attr("title",title),$(".musicer").text("歌 手："+artist),$(".musicer").attr("title",artist),$(".background").css({"background-image":"url("+bgPic+")","background-repeat":"no-repeat","background-position-x":"0px","background-position-y":"center","background-attchment":"fixed","background-size":"cover"}),play(),getlyric(),changeBackground()}})}function getlyric(){var i=$("audio").attr("sid");$.post("http://api.jirengu.com/fm/getLyric.php",{sid:i}).done(function(i){var i=JSON.parse(i);if(console.log(i),i.lyric){$(".music-lyric .lyric").empty();var c=i.lyric.split("\n"),t=/\[\d{2}:\d{2}.\d{2}\]/g,a=[];if(""!=c)for(var r in c){var n=c[r].match(t);if(n){var e=c[r].replace(t,"");for(j in n){var o=n[j].slice(1,-1).split(":"),l=60*parseInt(o[0],10)+parseFloat(o[1]);a.push([l,e])}}}a.sort(function(i,c){return i[0]-c[0]}),lyricArr=a,renderLyric()}}).fail(function(){$(".music-lyric .lyric").html("<li>本歌曲暂时展示没有歌词</li>")})}function renderLyric(){for(var i="",c=0;c<lyricArr.length;c++)i+="<li data-time='"+lyricArr[c][0]+"'>"+lyricArr[c][1]+"</li>";$(".music-lyric .lyric").append(i),setInterval(showLyric,100)}function showLyric(){for(var i=$(".lyric li").eq(15).outerHeight(),c=0;c<lyricArr.length;c++){var t=$(".lyric li").eq(c).attr("data-time"),a=$(".lyric li").eq(c+1).attr("data-time");myAudio.currentTime>t&&t<a&&($(".lyric li").removeClass("active"),$(".lyric li").eq(c).addClass("active"),$(".music-lyric .lyric").css("top",-i*(c-3)))}}function present(){var i=myAudio.currentTime/myAudio.duration*100;$(".progressbar").width(i+"%"),myAudio.currentTime==myAudio.duration&&getmusic()}function changeLyric(){$(".icon-leyic").toggleClass("lyriced"),$(".icon-leyic").hasClass("lyriced")?($(".background .music-lyric").css({display:"block"}),$(".background").css({"background-image":""}),$(".controls .icon-leyic").attr("title","隐藏歌词")):($(".background .music-lyric").css({display:"none"}),$(".controls .icon-leyic").attr("title","显示歌词"),$(".background").css({"background-image":"url("+bgPic+")"}))}function changeBackground(){$(".icon-leyic").hasClass("lyriced")&&($(".background .music-lyric").css({display:"block"}),$(".background").css({"background-image":""}),$(".controls .icon-leyic").attr("title","隐藏歌词"))}var myAudio=$("audio")[0],bgPic,lyricArr=[];$(".btn-play").click(function(){myAudio.paused?play():pause()}),$(".icon-diantai").click(function(){getChannel()}),$(".btn-next").click(function(){getmusic()}),setInterval(present,500),$(".basebar").mousedown(function(i){var c=i.clientX;console.log(c);var t=(c-$(this).offset().left)/400*100;myAudio.currentTime=myAudio.duration*t/100}),$(".icon-shoucang").on("click",function(){$(this).toggleClass("stared")}),$(".icon-danquxunhuan1").on("click",function(){$(this).toggleClass("recycleed").toggleClass("colored"),$(this).hasClass("recycleed")&&($("audio").attr("loop",!0),$(".icon-danquxunhuan1").attr("title","取消单曲循环")),$(this).hasClass("colored")&&($("audio").attr("loop",!1),$(".icon-danquxunhuan1").attr("title","单曲循环"))}),$(".icon-leyic").on("click",changeLyric),$(document).ready(getChannel());